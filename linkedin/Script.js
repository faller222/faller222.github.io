/*
<li class="jNEIrJnVtbtZvyXmswtZDAWWNnLdFtXDnORXZHYQ">
  <div class="AAZTpdAhnZaVIwXGHvPrJMZGjUcejfBXfM" data-chameleon-result-urn="urn:li:member:1581966" data-view-name="search-entity-result-universal-template">
    <div class="linked-area flex-1 cursor-pointer">
      <div class="wOJGJhwMYOWnnMgcnvVeOMnzMoeVvEqEHo">
        <div class="paaIXCnPyczHOmLZITEMKazkknPrKJYQ">
          <div class="display-flex align-items-center">
            <a class="MQRceAYuVswuDQdoNkKPTLyXBvQjqWHKulwM scale-down" aria-hidden="false" tabindex="0" href="https://www.linkedin.com/in/brianchristian?miniProfileUrn=urn%3Ali%3Afs_miniProfile%3AACoAAAAYI44Boq6IgZXzSLhhP5kAZ2EDk4Hgc6s" data-test-app-aware-link="">
              <div class="ivm-image-view-model">
                <div class="ivm-view-attr__img-wrapper">
                  <div class="presence-entity presence-entity--size-3">
                    <img src="https://media.licdn.com/dms/image/v2/D5603AQFNAQa0JOAtBw/profile-displayphoto-shrink_100_100/profile-displayphoto-shrink_100_100/0/1696017415071?e=1746662400&amp;v=beta&amp;t=O9LGdQUbWFlEOjp31v8UoZIo4pRFmPhKBk25D9zRYbY" loading="lazy" alt="Brian Christian" id="ember2793" class="presence-entity__image ivm-view-attr__img--centered EntityPhoto-circle-3 EntityPhoto-circle-3 evi-image lazy-image ember-view">
                    <div class="presence-entity__indicator presence-entity__indicator--size-3 presence-indicator hidden presence-indicator--size-3">
                      <span class="visually-hidden">Status is offline</span>
                    </div>
                  </div>
                </div>
              </div>
            </a>
          </div>
        </div>
        <div class="YDuWYuLUGiNlUfOpyQGUAFCmIpptrVCxw WfEFwyLJeGLCCOcMYkbkXbRaQynKYRhrA pt3 pb3 t-12 t-black--light">
          <div class="mb1">
            <div class="t-roman t-sans">
              <div class="display-flex">
                <span class="HdtltzHPuJxsfaNayjOAvOwESnKMiaCmqGIw VGSLfwIUJfZBxGEjlzTqlUZqfXfxycYz">
                  <span class="MrEytprLYLuuriNJHxcehgUPLDbHoGKTac t-16">
                    <a class="MQRceAYuVswuDQdoNkKPTLyXBvQjqWHKulwM" href="https://www.linkedin.com/in/brianchristian?miniProfileUrn=urn%3Ali%3Afs_miniProfile%3AACoAAAAYI44Boq6IgZXzSLhhP5kAZ2EDk4Hgc6s" data-test-app-aware-link="">
                      <span dir="ltr"><span aria-hidden="true">Brian Christian</span><span class="visually-hidden">View Brian Christian's profile</span></span>
                    </a>
                    <span class="entity-result__badge t-14 t-normal t-black--light">
                      <div class="display-flex align-items-baseline">
                        <span class="image-text-lockup__text entity-result__badge-text">
                          <span aria-hidden="true">• 3rd+</span><span class="visually-hidden">3rd+ degree connection</span>
                        </span>
                      </div>
                    </span>
                  </span>
                </span>
                <span aria-hidden="true" class="entity-result__badge-overflow align-self-flex-end t-14 t-normal t-black--light flex-shrink-zero">
                  <div class="display-flex align-items-baseline">
                    <span class="image-text-lockup__text entity-result__badge-text">
                      <span aria-hidden="true">• 3rd+</span><span class="visually-hidden">3rd+ degree connection</span>
                    </span>
                  </div>
                </span>
              </div>
            </div>
            <div class="idVVmuibTbcGZfFPojzRQZjbNlUBKixRp t-14 t-black t-normal">
              Founder and CEO/CTO Flying Cloud Technologies
            </div>
            <div class="bcrUFwPUxznPcIKsWswUEgEStLkuzffFN t-14 t-normal">
              San Francisco Bay Area
            </div>
          </div>
          <p class="YlxKidoSFreXbndZSuqqLycVvdzcPmMTI entity-result__summary--2-lines t-12 t-black--light mb1">
            Current:<span class="white-space-pre"> </span><strong>Founder</strong><span class="white-space-pre"> </span>and<span class="white-space-pre"> </span><strong>CEO</strong>/<strong>CTO</strong><span class="white-space-pre"> </span>at Flying Cloud Technology
          </p>
          <div class="entity-result__insights t-12">
            <div class="JahboabZyObknXtsLylqEElqVliYTTSGJEo">
              <div class="ivm-image-view-model reusable-search-simple-insight__image flex-shrink-zero mr1">
                <div class="ivm-view-attr__img-wrapper">
                  <li-icon aria-hidden="true" type="people" class="ivm-view-attr__icon" size="small"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" data-supported-dps="16x16" fill="currentColor" class="mercado-match" width="16" height="16" focusable="false">
                    <path d="M14 11.75V15H9v-3.25A1.75 1.75 0 0110.75 10h1.5A1.75 1.75 0 0114 11.75zM11.5 9A2.5 2.5 0 109 6.5 2.5 2.5 0 0011.5 9zM5 1a3 3 0 103 3 3 3 0 00-3-3zm.75 7h-1.5A2.25 2.25 0 002 10.25V15h6v-4.75A2.25 2.25 0 005.75 8z"></path>
                  </svg></li-icon>
                </div>
              </div>
              <div class="reusable-search-simple-insight__text-container">
                <span class="CiQkGklrtzRyXmeOUocNzbSBqQNYcmKwDMsyc reusable-search-simple-insight__text--small">
                  2K followers
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="tUVVIKScUcZwGInuRgIwLHUIhzBEXHuauPaA WfEFwyLJeGLCCOcMYkbkXbRaQynKYRhrA">
          <div>
            <button aria-label="Follow Brian Christian" id="ember2787" class="artdeco-button artdeco-button--2 artdeco-button--secondary ember-view" type="button">
              <span class="artdeco-button__text">Follow</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</li>
*/

/*
 <span class="display-flex t-normal flex-1" aria-hidden="true">Connect</span>
 
 <span class="artdeco-button__text">Send without a note</span>
 */

// Script to find the first LinkedIn profile with a "Follow" button, click on the name link,
// then click Connect, Send without a note, and go back to the search page

// Function to find and click the Connect button
async function clickConnectButton() {
  console.log("Looking for Connect button...");
  
  // Wait for 1000ms to allow the page to render
  await new Promise(resolve => setTimeout(resolve, 1000));
  
  // Find all spans that contain "Connect" text
  const connectSpans = Array.from(document.querySelectorAll('span')).filter(span => {
    return span.textContent.trim() === 'Connect';
  });
  
  console.log(`Found ${connectSpans.length} Connect spans`);
  
  if (connectSpans.length > 0) {
    // Click the first Connect span
    connectSpans[0].click();
    console.log("Clicked on Connect span");
    return true;
  } else {
    console.log("No Connect span found");
    return false;
  }
}

// Function to click "Send without a note" button
async function clickSendWithoutNote() {
  console.log("Looking for 'Send without a note' button...");
  
  // Wait for 700ms for the modal to appear
  await new Promise(resolve => setTimeout(resolve, 700));
  
  // Find all spans that contain "Send without a note" text
  const sendSpans = Array.from(document.querySelectorAll('span')).filter(span => {
    return span.textContent.trim() === 'Send without a note';
  });
  
  console.log(`Found ${sendSpans.length} 'Send without a note' spans`);
  
  if (sendSpans.length > 0) {
    // Click the first "Send without a note" span
    sendSpans[0].click();
    console.log("Clicked on 'Send without a note' span");
    return true;
  } else {
    console.log("No 'Send without a note' span found");
    return false;
  }
}

// Function to go back to the search page and log "connected"
async function goBackAndLogConnected() {
  // Wait a moment for the connection to be processed
  await new Promise(resolve => setTimeout(resolve, 500));
  
  // Go back to the previous page (search results)
  window.history.back();
  
  console.log("connected");
  return true;
}

// Function to run when the DOM is fully loaded
async function findAndClickFirstProfileWithFollowButton() {
  console.log("Script started: Looking for profiles with Follow buttons...");
  
  // Find all buttons that contain "Follow" text
  const followButtons = Array.from(document.querySelectorAll('button')).filter(button => {
    // Check if the button or any of its children contains "Follow" text
    return button.textContent.trim().includes('Follow');
  });
  
  console.log(`Found ${followButtons.length} follow buttons`);
  
  if (followButtons.length > 0) {
    // Get the first follow button
    const firstFollowButton = followButtons[0];
    
    // Find the closest li element (the profile container)
    const profileLi = firstFollowButton.closest('li');
    
    if (profileLi) {
      // Find the profile link with data-test-app-aware-link attribute within this li
      const profileLink = profileLi.querySelector('a[data-test-app-aware-link]');
      
      if (profileLink) {
        console.log("Found profile link to click:", profileLink.href);
        
        // Click on the profile link
        profileLink.click();
        console.log("Clicked on profile link!");
        
        // Now perform the additional actions
        await clickConnectButton();
        await clickSendWithoutNote();
        await goBackAndLogConnected();
        
        return true;
      } else {
        console.log("No profile link found within the li element containing the Follow button");
      }
    } else {
      console.log("Could not find the li element containing the Follow button");
    }
  } else {
    console.log("No Follow buttons found on the page");
  }
  
  return false;
}

// Alternative approach: find all profile links first, then check if they have a Follow button
async function alternativeFindAndClick() {
  console.log("Trying alternative approach...");
  
  // Find all profile links
  const profileLinks = document.querySelectorAll('a[data-test-app-aware-link]');
  console.log(`Found ${profileLinks.length} profile links`);
  
  for (const link of profileLinks) {
    // Find the closest li element
    const li = link.closest('li');
    
    if (li) {
      // Check if this li contains a Follow button
      const hasFollowButton = li.querySelector('button')?.textContent.includes('Follow');
      
      if (hasFollowButton) {
        console.log("Found profile with Follow button:", link.href);
        link.click();
        console.log("Clicked on profile link!");
        
        // Now perform the additional actions
        await clickConnectButton();
        await clickSendWithoutNote();
        await goBackAndLogConnected();
        
        return true;
      }
    }
  }
  
  console.log("No profiles with Follow buttons found using alternative approach");
  return false;
}

// Execute the main function
async function executeScript() {
  // Try the first approach
  const success = await findAndClickFirstProfileWithFollowButton();
  
  // If the first approach fails, try the alternative
  if (!success) {
    await alternativeFindAndClick();
  }
}

// Run the script
executeScript();
